<!DOCTYPE html>
<html>
<head>
    <title>Email Auth Test - Simple</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; }
        button { background: #4285f4; color: white; border: none; padding: 12px 24px; cursor: pointer; border-radius: 5px; width: 100%; margin: 10px 0; }
        button:hover { background: #357ae8; }
        .success { background: #d4edda; padding: 15px; border-radius: 5px; margin: 10px 0; color: #155724; }
        .error { background: #f8d7da; padding: 15px; border-radius: 5px; margin: 10px 0; color: #721c24; }
        .info { background: #d1ecf1; padding: 15px; border-radius: 5px; margin: 10px 0; color: #0c5460; }
        .warning { background: #fff3cd; padding: 15px; border-radius: 5px; margin: 10px 0; color: #856404; }
    </style>
</head>
<body>
    <h1>ðŸ“§ Email Authentication Debug</h1>
    
    <div class="warning">
        <strong>Important:</strong> Supabase may require email confirmation. Check your email after signing up!
    </div>

    <input type="email" id="email" placeholder="your.real.email@gmail.com" value="">
    <input type="password" id="password" placeholder="password123" value="password123">
    
    <button onclick="signUp()">1. Sign Up (Creates Account)</button>
    <button onclick="signIn()">2. Sign In (After Confirmation)</button>
    <button onclick="signInWithoutConfirmation()">Sign In (Skip Confirmation Check)</button>
    <button onclick="resendConfirmation()">Resend Confirmation Email</button>
    <button onclick="checkUser()">Check User Status</button>
    
    <div id="result"></div>

    <h3>Debug Info:</h3>
    <div id="debug"></div>

    <script>
        const SUPABASE_URL = 'https://cbohkxomfugalzhmvkmd.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNib2hreG9tZnVnYWx6aG12a21kIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ5ODgwMTUsImV4cCI6MjA3MDU2NDAxNX0.PA2_pI11rfUzi3c-M5fpaP4ciLwbWmn0ZBEL5PVhyFs';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        async function signUp() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                showResult('Please enter email and password', 'error');
                return;
            }
            
            showResult('Creating account...', 'info');
            
            const { data, error } = await supabase.auth.signUp({
                email: email,
                password: password,
                options: {
                    emailRedirectTo: window.location.href,
                    data: {
                        full_name: 'Test User'
                    }
                }
            });
            
            console.log('SignUp Response:', { data, error });
            updateDebug({ signUpResponse: { data, error } });
            
            if (error) {
                showResult(`Error: ${error.message}`, 'error');
            } else if (data.user) {
                if (data.user.identities && data.user.identities.length === 0) {
                    showResult('A user with this email already exists. Try signing in instead.', 'warning');
                } else if (data.user.confirmed_at) {
                    showResult('Account created and confirmed! You can sign in now.', 'success');
                } else {
                    showResult(`
                        Account created! Please check your email (${email}) for a confirmation link.
                        <br><br>
                        <strong>Note:</strong> If you don't see the email, check your spam folder.
                        <br><br>
                        User ID: ${data.user.id}
                    `, 'success');
                }
            }
        }
        
        async function signIn() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                showResult('Please enter email and password', 'error');
                return;
            }
            
            showResult('Signing in...', 'info');
            
            const { data, error } = await supabase.auth.signInWithPassword({
                email: email,
                password: password
            });
            
            console.log('SignIn Response:', { data, error });
            updateDebug({ signInResponse: { data, error } });
            
            if (error) {
                if (error.message.includes('Email not confirmed')) {
                    showResult(`
                        Email not confirmed yet. Please check your email for the confirmation link.
                        <br><br>
                        <button onclick="resendConfirmation()">Resend Confirmation Email</button>
                    `, 'warning');
                } else {
                    showResult(`Error: ${error.message}`, 'error');
                }
            } else if (data.user) {
                showResult(`
                    âœ… Signed in successfully!<br>
                    Email: ${data.user.email}<br>
                    ID: ${data.user.id}<br>
                    Confirmed: ${data.user.confirmed_at ? 'Yes' : 'No'}
                `, 'success');
            }
        }
        
        async function signInWithoutConfirmation() {
            // This attempts to sign in even if email isn't confirmed
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            const { data, error } = await supabase.auth.signInWithPassword({
                email: email,
                password: password
            });
            
            updateDebug({ directSignIn: { data, error } });
            
            if (data?.session) {
                showResult('Signed in (session created)', 'success');
            } else if (error) {
                showResult(`Cannot sign in: ${error.message}`, 'error');
            }
        }
        
        async function resendConfirmation() {
            const email = document.getElementById('email').value;
            
            if (!email) {
                showResult('Please enter your email', 'error');
                return;
            }
            
            const { data, error } = await supabase.auth.resend({
                type: 'signup',
                email: email
            });
            
            if (error) {
                showResult(`Error: ${error.message}`, 'error');
            } else {
                showResult('Confirmation email sent! Check your inbox.', 'success');
            }
        }
        
        async function checkUser() {
            const { data: { user }, error } = await supabase.auth.getUser();
            
            if (user) {
                showResult(`
                    Current User:<br>
                    Email: ${user.email}<br>
                    ID: ${user.id}<br>
                    Confirmed: ${user.confirmed_at ? 'Yes' : 'No'}
                `, 'info');
            } else {
                showResult('No user logged in', 'info');
            }
            
            updateDebug({ currentUser: user, error });
        }
        
        function showResult(message, type) {
            document.getElementById('result').innerHTML = `<div class="${type}">${message}</div>`;
        }
        
        function updateDebug(data) {
            const debugDiv = document.getElementById('debug');
            debugDiv.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }
        
        // Check for email confirmation callback
        window.addEventListener('load', () => {
            const hashParams = new URLSearchParams(window.location.hash.substring(1));
            if (hashParams.get('type') === 'signup' && hashParams.get('access_token')) {
                showResult('âœ… Email confirmed! You can now sign in.', 'success');
            }
        });
    </script>
</body>
</html>